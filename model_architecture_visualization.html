<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>DualBackboneTimeLapseClassifier Architecture</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            margin: 0;
            padding: 20px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
        }
        
        .container {
            max-width: 1400px;
            margin: 0 auto;
            background: white;
            border-radius: 15px;
            padding: 30px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
        }
        
        h1 {
            text-align: center;
            color: #2c3e50;
            margin-bottom: 30px;
            font-size: 2.5em;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.1);
        }
        
        .architecture {
            position: relative;
            width: 100%;
            height: 800px;
            margin: 20px 0;
            overflow: visible;
        }
        
        .layer {
            position: absolute;
            border-radius: 10px;
            padding: 10px;
            text-align: center;
            font-weight: bold;
            font-size: 12px;
            border: 2px solid #2c3e50;
            transition: all 0.3s ease;
            cursor: pointer;
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
        }
        
        .layer:hover {
            transform: scale(1.05);
            box-shadow: 0 8px 16px rgba(0,0,0,0.2);
            z-index: 10;
        }
        
        .input { background: #e8f4fd; }
        .backbone { background: #b3d9ff; }
        .encoder { background: #66b2ff; }
        .attention { background: #1a8cff; color: white; }
        .fusion { background: #0066cc; color: white; }
        .classifier { background: #004c99; color: white; }
        .output { background: #003366; color: white; }
        
        .arrow {
            position: absolute;
            z-index: 1;
        }
        
        .arrow::before {
            content: '';
            position: absolute;
            width: 0;
            height: 0;
            border-left: 8px solid transparent;
            border-right: 8px solid transparent;
            border-bottom: 12px solid #2c3e50;
        }
        
        .arrow-down {
            width: 2px;
            background: #2c3e50;
        }
        
        .arrow-diagonal {
            background: #2c3e50;
            height: 2px;
            transform-origin: left center;
        }
        
        .legend {
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            gap: 20px;
            margin-top: 30px;
        }
        
        .legend-item {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 8px 15px;
            border-radius: 20px;
            background: #f8f9fa;
            border: 1px solid #dee2e6;
        }
        
        .legend-color {
            width: 20px;
            height: 20px;
            border-radius: 4px;
            border: 1px solid #2c3e50;
        }
        
        .info-panel {
            background: #f8f9fa;
            border-radius: 10px;
            padding: 20px;
            margin-top: 30px;
            border-left: 5px solid #007bff;
        }
        
        .feature-list {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }
        
        .feature-card {
            background: white;
            padding: 15px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            border-left: 4px solid #007bff;
        }
        
        .tooltip {
            position: absolute;
            background: rgba(0,0,0,0.9);
            color: white;
            padding: 10px;
            border-radius: 5px;
            font-size: 11px;
            z-index: 1000;
            display: none;
            max-width: 250px;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>DualBackboneTimeLapseClassifier Architecture</h1>
        
        <div class="architecture" id="architecture">
            <!-- Input Layers -->
            <div class="layer input" style="left: 50px; top: 50px; width: 200px; height: 60px;" 
                 data-tooltip="Context frames: Sequential temporal frames (5 frames) showing progression over time. Shape: (Batch×5×3×H×W)">
                Context Frames<br>(B×5×3×H×W)
            </div>
            
            <div class="layer input" style="left: 750px; top: 50px; width: 200px; height: 60px;"
                 data-tooltip="Reference frames: Baseline comparison frames (3 frames) for reference. Shape: (Batch×3×3×H×W)">
                Reference Frames<br>(B×3×3×H×W)
            </div>
            
            <!-- Backbone Encoders -->
            <div class="layer backbone" style="left: 50px; top: 150px; width: 200px; height: 80px;"
                 data-tooltip="EfficientNet-B0 backbone for processing context frames. Uses 3 input channels (RGB) with GroupNorm instead of BatchNorm.">
                EfficientNet-B0<br>Context Backbone<br>(3 channels)
            </div>
            
            <div class="layer backbone" style="left: 750px; top: 150px; width: 200px; height: 80px;"
                 data-tooltip="EfficientNet-B0 backbone for processing concatenated reference frames. Uses 6 input channels (2 RGB frames concatenated).">
                EfficientNet-B0<br>Reference Backbone<br>(6 channels)
            </div>
            
            <!-- Feature Compression -->
            <div class="layer encoder" style="left: 50px; top: 270px; width: 200px; height: 60px;"
                 data-tooltip="Linear layer to compress context features to 512 dimensions for consistent processing.">
                Linear Compression<br>to 512 dims
            </div>
            
            <div class="layer encoder" style="left: 750px; top: 270px; width: 200px; height: 60px;"
                 data-tooltip="Linear layer to compress reference features to 512 dimensions for consistent processing.">
                Linear Compression<br>to 512 dims
            </div>
            
            <!-- Feature Reshaping -->
            <div class="layer encoder" style="left: 50px; top: 370px; width: 200px; height: 60px;"
                 data-tooltip="Reshape context features to sequence format for transformer processing. Shape: (Batch×5×512)">
                Reshape to<br>(B×5×512)
            </div>
            
            <div class="layer encoder" style="left: 750px; top: 370px; width: 200px; height: 60px;"
                 data-tooltip="Reshape reference features to single token format. Shape: (Batch×1×512)">
                Reshape to<br>(B×1×512)
            </div>
            
            <!-- Concatenation -->
            <div class="layer fusion" style="left: 400px; top: 470px; width: 200px; height: 60px;"
                 data-tooltip="Concatenate context and reference features into joint sequence. Shape: (Batch×6×512)">
                Concatenate Features<br>(B×6×512)
            </div>
            
            <!-- Positional Encoding + Transformer -->
            <div class="layer attention" style="left: 350px; top: 570px; width: 300px; height: 80px;"
                 data-tooltip="Add positional encoding and process through Transformer Encoder with 4 layers and 8 attention heads. Uses GELU activation and norm-first architecture.">
                Positional Encoding<br>+ Transformer Encoder<br>(4 layers, 8 heads)
            </div>
            
            <!-- Cross Attention (Currently Unused) -->
            <div class="layer attention" style="left: 50px; top: 570px; width: 250px; height: 80px; opacity: 0.6; border-style: dashed;"
                 data-tooltip="Cross-attention layer defined in the model but currently not used in the forward pass. Could be used for attending between context and reference features. 8 attention heads with dropout.">
                Cross Attention<br>(8 heads)<br><em style='font-size:10px;'>(Not Currently Used)</em>
            </div>
            
            <!-- Feature Separation and Pooling -->
            <div class="layer fusion" style="left: 100px; top: 690px; width: 180px; height: 60px;"
                 data-tooltip="Extract and pool context features using mean pooling across temporal dimension. Shape: (Batch×512)">
                Context Features<br>Mean Pooling<br>(B×512)
            </div>
            
            <div class="layer fusion" style="left: 720px; top: 690px; width: 180px; height: 60px;"
                 data-tooltip="Extract reference features using the last token from transformer output. Shape: (Batch×512)">
                Reference Features<br>Last Token<br>(B×512)
            </div>
            
            <!-- Final Fusion -->
            <div class="layer fusion" style="left: 400px; top: 790px; width: 200px; height: 60px;"
                 data-tooltip="Concatenate processed context and reference features. Shape: (Batch×1024)">
                Feature Concatenation<br>(B×1024)
            </div>
            
            <!-- Classifier -->
            <div class="layer classifier" style="left: 425px; top: 890px; width: 150px; height: 60px;"
                 data-tooltip="Multi-layer perceptron classifier with dropout regularization. Architecture: 1024→512→256→2">
                MLP Classifier<br>1024→512→256→2
            </div>
            
            <!-- Output -->
            <div class="layer output" style="left: 450px; top: 990px; width: 100px; height: 50px;"
                 data-tooltip="Final classification output with 2 classes (binary classification). Shape: (Batch×2)">
                Output<br>(B×2)
            </div>
            
            <!-- Arrows -->
            <div class="arrow arrow-down" style="left: 149px; top: 110px; height: 40px;"></div>
            <div class="arrow arrow-down" style="left: 149px; top: 230px; height: 40px;"></div>
            <div class="arrow arrow-down" style="left: 149px; top: 330px; height: 40px;"></div>
            
            <div class="arrow arrow-down" style="left: 849px; top: 110px; height: 40px;"></div>
            <div class="arrow arrow-down" style="left: 849px; top: 230px; height: 40px;"></div>
            <div class="arrow arrow-down" style="left: 849px; top: 330px; height: 40px;"></div>
            
            <div class="arrow arrow-diagonal" style="left: 250px; top: 400px; width: 150px; transform: rotate(15deg);"></div>
            <div class="arrow arrow-diagonal" style="left: 600px; top: 400px; width: 150px; transform: rotate(-15deg);"></div>
            
            <div class="arrow arrow-down" style="left: 499px; top: 530px; height: 40px;"></div>
            
            <div class="arrow arrow-diagonal" style="left: 450px; top: 650px; width: 100px; transform: rotate(-45deg);"></div>
            <div class="arrow arrow-diagonal" style="left: 550px; top: 650px; width: 100px; transform: rotate(45deg);"></div>
            
            <div class="arrow arrow-diagonal" style="left: 280px; top: 750px; width: 120px; transform: rotate(25deg);"></div>
            <div class="arrow arrow-diagonal" style="left: 600px; top: 750px; width: 120px; transform: rotate(-25deg);"></div>
            
            <div class="arrow arrow-down" style="left: 499px; top: 850px; height: 40px;"></div>
            <div class="arrow arrow-down" style="left: 499px; top: 950px; height: 40px;"></div>
        </div>
        
        <div class="legend">
            <div class="legend-item">
                <div class="legend-color input"></div>
                <span>Input</span>
            </div>
            <div class="legend-item">
                <div class="legend-color backbone"></div>
                <span>Backbone</span>
            </div>
            <div class="legend-item">
                <div class="legend-color encoder"></div>
                <span>Feature Processing</span>
            </div>
            <div class="legend-item">
                <div class="legend-color attention"></div>
                <span>Transformer</span>
            </div>
            <div class="legend-item">
                <div class="legend-color fusion"></div>
                <span>Feature Fusion</span>
            </div>
            <div class="legend-item">
                <div class="legend-color classifier"></div>
                <span>Classification</span>
            </div>
            <div class="legend-item">
                <div class="legend-color output"></div>
                <span>Output</span>
            </div>
        </div>
        
        <div class="info-panel">
            <h3>Model Architecture Overview</h3>
            <p>The DualBackboneTimeLapseClassifier is a sophisticated neural network designed for time-lapse image classification using dual EfficientNet backbones and transformer-based temporal modeling.</p>
            
            <div class="feature-list">
                <div class="feature-card">
                    <h4>Dual Backbone Design</h4>
                    <p>Separate EfficientNet-B0 encoders for context (3 channels) and reference frames (6 channels from concatenated frames).</p>
                </div>
                <div class="feature-card">
                    <h4>Temporal Modeling</h4>
                    <p>Transformer encoder with 4 layers and 8 attention heads processes temporal sequences with positional encoding.</p>
                </div>
                <div class="feature-card">
                    <h4>Feature Fusion</h4>
                    <p>Context features are mean-pooled while reference features use the last token, then concatenated for classification.</p>
                </div>
                <div class="feature-card">
                    <h4>Normalization</h4>
                    <p>GroupNorm replaces BatchNorm for better performance with varying batch sizes and improved stability.</p>
                </div>
            </div>
        </div>
        
        <div class="tooltip" id="tooltip"></div>
    </div>
    
    <script>
        // Tooltip functionality
        const layers = document.querySelectorAll('.layer');
        const tooltip = document.getElementById('tooltip');
        
        layers.forEach(layer => {
            layer.addEventListener('mouseenter', (e) => {
                const tooltipText = e.target.getAttribute('data-tooltip');
                if (tooltipText) {
                    tooltip.innerHTML = tooltipText;
                    tooltip.style.display = 'block';
                }
            });
            
            layer.addEventListener('mousemove', (e) => {
                tooltip.style.left = e.pageX + 10 + 'px';
                tooltip.style.top = e.pageY + 10 + 'px';
            });
            
            layer.addEventListener('mouseleave', () => {
                tooltip.style.display = 'none';
            });
        });
        
        // Add click animation
        layers.forEach(layer => {
            layer.addEventListener('click', (e) => {
                e.target.style.animation = 'pulse 0.3s ease';
                setTimeout(() => {
                    e.target.style.animation = '';
                }, 300);
            });
        });
        
        // Add pulse animation
        const style = document.createElement('style');
        style.textContent = `
            @keyframes pulse {
                0% { transform: scale(1); }
                50% { transform: scale(1.1); }
                100% { transform: scale(1); }
            }
        `;
        document.head.appendChild(style);
    </script>
</body>
</html>
